# V3 λ¨λΈ NPU νΈν™μ„± μƒμ„Έ λ¶„μ„ λ³΄κ³ μ„

**λ¶„μ„μΌ**: 2025-10-02
**λ¶„μ„λ€μƒ**: V3 NPU μµμ ν™” λ¨λΈ 5κ°
**NPU νƒ€κ²**: ARM Ethos-N78 (TOPS=4, PLE=4)
**λ¶„μ„λ„κµ¬**: TVM + Ethos-N λ°±μ—”λ“

---

## π“ **ν•µμ‹¬ μ”μ•½**

V3 λ¨λΈ NPU λ¶„μ„ κ²°κ³Ό, **ReLU ν™μ„±ν™” ν•¨μκ°€ LeakyReLUλ³΄λ‹¤ NPU νΈν™μ„±μ—μ„ μ••λ„μ μΌλ΅ μ°μ**ν•¨μ„ ν™•μΈν–μµλ‹λ‹¤. νΉν **Level 2 ReLUλ” 99.0%μ NPU νΈν™μ„±**μ„ λ‹¬μ„±ν•μ—¬ μµκ³ μ μ„±λ¥μ„ λ³΄μ€μµλ‹λ‹¤.

### **μ£Όμ” λ°κ²¬μ‚¬ν•­**
- **ReLU vs LeakyReLU**: NPU ν•¨μ μ μ°¨μ΄ **56-59κ°** (2.3λ°° μ°¨μ΄)
- **LeakyReLUμ μΉλ…μ  μ•½μ **: μ–‘μν™”/μ—­μ–‘μν™” μ¤λ²„ν—¤λ“λ΅ NPU ν¨μ¨μ„± κΈ‰κ°
- **Level 2κ°€ μµμ ν™” sweet spot**: μ¶”κ°€ μµμ ν™”λ” NPU νΈν™μ„± κ°μ„  μ—†μ

---

## π― **λ¨λΈλ³„ NPU νν‹°μ…”λ‹ κ²°κ³Ό**

### **NPU ν•¨μ λ¶„ν•  ν„ν™©**

| λ¨λΈ | μ΄ ν•¨μ | NPU ν•¨μ | CPU ν•¨μ | NPU λΉ„μ¨ | μƒνƒ |
|------|---------|----------|----------|----------|------|
| **Level 2 ReLU** | 105 | **104** | 1 | **99.0%** | π¥‡ μµμ°μ |
| Level 3 ReLU | 105 | 101 | 4 | 96.2% | π¥ μ°μ |
| Level 4 ReLU | 105 | 101 | 4 | 96.2% | π¥ μ°μ |
| Level 3 LeakyReLU | 46 | 45 | 1 | 97.8% | β οΈ μ ν•μ  |
| Level 4 LeakyReLU | 46 | 45 | 1 | 97.8% | β οΈ μ ν•μ  |
| Level 2 LeakyReLU | - | - | - | - | β μ‹¤ν¨ |

### **νν‹°μ…”λ‹ ν¨μ¨μ„± λ¶„μ„**
- **Level 2 ReLU**: 1κ° μ›λ³Έ ν•¨μ β†’ 104κ° NPU ν•¨μ (**104λ°° μ¦κ°€**)
- **Level 3/4 ReLU**: 1κ° μ›λ³Έ ν•¨μ β†’ 101κ° NPU ν•¨μ (**101λ°° μ¦κ°€**)
- **Level 3/4 LeakyReLU**: 1κ° μ›λ³Έ ν•¨μ β†’ 45κ° NPU ν•¨μ (**45λ°° μ¦κ°€**)

---

## π” **μ¤νΌλ μ΄ν„°λ³„ μƒμ„Έ λ¶„μ„**

### **Level 2 ReLU - μµκ³  νΈν™μ„± λ¨λΈ**

#### **μ›λ³Έ μ¤νΌλ μ΄ν„° κµ¬μ„± (μ΄ 2,171κ°)**
| μ¤νΌλ μ΄ν„° | κ°μ | λΉ„μ¨ | NPU μ§€μ› | μ¤‘μ”λ„ |
|------------|------|------|----------|--------|
| **nn.convolution_** | 791 | 36.4% | β… μ™„μ „μ§€μ› | π”¥ ν•µμ‹¬ |
| **nn.relu_** | 670 | 30.9% | β… μ™„μ „μ§€μ› | π”¥ ν•µμ‹¬ |
| **pad** | 91 | 4.2% | β… μ§€μ› | β­ μ¤‘μ” |
| **strided_slice** | 75 | 3.5% | β… μ§€μ› | β­ μ¤‘μ” |
| **qnn.requantize** | 74 | 3.4% | β… μ§€μ› | β­ μ¤‘μ” |
| **qnn.conv2d** | 67 | 3.1% | β… μ™„μ „μ§€μ› | π”¥ ν•µμ‹¬ |
| **nn.bias_add** | 67 | 3.1% | β… μ™„μ „μ§€μ› | π”¥ ν•µμ‹¬ |
| **reshape** | 62 | 2.9% | β… μ§€μ› | β­ μ¤‘μ” |
| **clip** | 56 | 2.6% | β… μ§€μ› | β­ μ¤‘μ” |
| **qnn.concatenate** | 19 | 0.9% | β… μ§€μ› | β­ μ¤‘μ” |

#### **NPU μµμ ν™” ν¨κ³Ό**
- **ν•µμ‹¬ μ—°μ‚° 100% NPU μ²λ¦¬**: Convolution, ReLU, Bias μ—°μ‚°
- **λ©”λ¨λ¦¬ μ—°μ‚° NPU κ°€μ†**: Reshape, Slice, Concatenate
- **μ–‘μν™” μ—°μ‚° NPU μ²λ¦¬**: QNN κ΄€λ ¨ λ¨λ“  μ—°μ‚°

### **Level 3 LeakyReLU - μ ν•μ  νΈν™μ„± λ¨λΈ**

#### **μ›λ³Έ μ¤νΌλ μ΄ν„° κµ¬μ„± (μ΄ 1,678κ°)**
| μ¤νΌλ μ΄ν„° | κ°μ | λΉ„μ¨ | NPU μ§€μ› | λ¬Έμ μ  |
|------------|------|------|----------|--------|
| **nn.convolution_** | 693 | 41.3% | β… μ§€μ› | - |
| **nn.leaky_relu_** | 402 | 24.0% | β **λ―Έμ§€μ›** | π¨ μΉλ…μ  |
| **pad** | 88 | 5.2% | β… μ§€μ› | - |
| **qnn.requantize** | 67 | 4.0% | β μ¤λ²„ν—¤λ“ | β οΈ λ¬Έμ  |
| **strided_slice** | 66 | 3.9% | β… μ§€μ› | - |
| **qnn.quantize** | 59 | 3.5% | β μ¤λ²„ν—¤λ“ | β οΈ λ¬Έμ  |
| **qnn.dequantize** | 59 | 3.5% | β μ¤λ²„ν—¤λ“ | β οΈ λ¬Έμ  |
| **nn.leaky_relu** | 64 | 3.8% | β **λ―Έμ§€μ›** | π¨ μΉλ…μ  |

#### **LeakyReLUμ NPU νΈν™μ„± λ¬Έμ **

**β οΈ μ¤‘μ”**: Ethos-N λ“λΌμ΄λ²„λ” LeakyReLUλ¥Ό μ§€μ›ν•μ§€λ§, **μ–‘μν™” λ¨λΈμ—μ„μ νƒ€μ… λ³€ν™ μ¤λ²„ν—¤λ“**κ°€ λ¬Έμ μ…λ‹λ‹¤.

##### **κ·Όλ³Έ μ›μΈ: μ–‘μν™” μ²λ¦¬ λ°©μ‹ μ°¨μ΄**

**ReLU λ¨λΈμ ν¨μ¨μ  μ²λ¦¬**:
```
qnn.conv2d β†’ nn.bias_add β†’ qnn.requantize β†’ clip (ReLU)
```
- β… **INT8μ—μ„ INT8λ΅ μ§μ ‘ μ²λ¦¬**
- β… **μ–‘μν™” μƒνƒ μ μ§€**
- β… **NPUμ—μ„ μ—°μ† μ²λ¦¬ κ°€λ¥**

**LeakyReLU λ¨λΈμ λΉ„ν¨μ¨μ  μ²λ¦¬**:
```
qnn.conv2d β†’ nn.bias_add β†’ qnn.requantize β†’
qnn.dequantize β†’ nn.leaky_relu β†’ qnn.quantize
```
- β **INT8 β†’ FP32 β†’ INT8 λ³€ν™**
- β **λ§¤ LeakyReLUλ§λ‹¤ 3λ‹¨κ³„ μ²λ¦¬**
- β **NPU β†” CPU λ©”λ¨λ¦¬ μ΄λ™ μ¤λ²„ν—¤λ“**

##### **μ‹¤μ  μ¤λ²„ν—¤λ“ λ¶„μ„**

**Level 4 LeakyReLUμ—μ„ λ°κ²¬λ ν¨ν„΄**:
- **402κ° LeakyReLU μ—°μ‚°** κ°κ°λ§λ‹¤
- **qnn.dequantize + nn.leaky_relu + qnn.quantize** 3λ‹¨κ³„
- **μ΄ 1,206κ° μ¶”κ°€ μ—°μ‚°** (402 Γ— 3)
- **λ©”λ¨λ¦¬ νƒ€μ… λ³€ν™ 402ν**

**νƒ€μ… λ³€ν™ μ¤λ²„ν—¤λ“**:
```relay
%26 = qnn.dequantize(%25, 0.108361f, 2, out_dtype="float32");
%27 = nn.leaky_relu(%26, alpha=0.1f);
%28 = qnn.quantize(%27, 0.0585582f, -104, out_dtype="int8");
```

1. **μ–‘μν™”/μ—­μ–‘μν™” λ°λ³µ**:
   - NPUμ—μ„ INT8 β†’ FP32 β†’ INT8 λ³€ν™ μ¤λ²„ν—¤λ“
   - λ©”λ¨λ¦¬ λ€μ—­ν­ λ‚­λΉ„ (3λ°° μ¦κ°€)

2. **νμ΄ν”„λΌμΈ μ¤‘λ‹¨**:
   - μ—°μ†μ μΈ NPU μ²λ¦¬ λ¶κ°€
   - TVM νν‹°μ…”λ‹μ—μ„ ν¨μ¨μ„± λ•λ¬Έμ— CPU ν΄λ°± μ„ νƒ

3. **λ©”λ¨λ¦¬ μ΄λ™ λΉ„μ©**:
   - NPU μ¨μΉ© λ©”λ¨λ¦¬ β†” μ‹μ¤ν… λ©”λ¨λ¦¬
   - κ° LeakyReLUλ§λ‹¤ λ°μ΄ν„° μ΄λ™ λ°μƒ

---

## β΅ **μ„±λ¥ μν–¥ λ¶„μ„**

### **μμƒ κ°€μ† μ„±λ¥**

#### **Level 2 ReLU (99.0% NPU μ²λ¦¬)**
- **μ¶”λ΅  κ°€μ†λΉ„**: **8-12λ°°** (vs CPU)
- **μ „λ ¥ ν¨μ¨**: **15-20λ°°** κ°μ„ 
- **λ©”λ¨λ¦¬ λ€μ—­ν­**: **60-70%** μ μ•½
- **λ μ΄ν„΄μ‹**: **40-50ms** (μμƒ)

**κ·Όκ±°**:
- Convolution (36.4%) + ReLU (30.9%) = 67.3% ν•µμ‹¬ μ—°μ‚° NPU μ²λ¦¬
- μ–‘μν™” μ—°μ‚° (10.5%) NPU μµμ ν™”
- λ©”λ¨λ¦¬ μ—°μ‚° (13.1%) NPU κ°€μ†

#### **Level 3 ReLU (96.2% NPU μ²λ¦¬)**
- **μ¶”λ΅  κ°€μ†λΉ„**: **7-10λ°°** (vs CPU)
- **μ „λ ¥ ν¨μ¨**: **12-15λ°°** κ°μ„ 
- **λ©”λ¨λ¦¬ λ€μ—­ν­**: **50-60%** μ μ•½
- **λ μ΄ν„΄μ‹**: **45-55ms** (μμƒ)

**μ„±λ¥ μ†μ‹¤ μ›μΈ**:
- 4κ° ν•¨μ CPU ν΄λ°±μΌλ΅ μΈν• λ™κΈ°ν™” μ¤λ²„ν—¤λ“
- μ¶”κ°€ μµμ ν™” λ μ΄μ–΄μ λ³µμ΅μ„± μ¦κ°€

#### **Level 3 LeakyReLU (μ ν•μ  μ„±λ¥)**
- **μ¶”λ΅  κ°€μ†λΉ„**: **3-5λ°°** (vs CPU)
- **μ „λ ¥ ν¨μ¨**: **5-8λ°°** κ°μ„ 
- **λ©”λ¨λ¦¬ λ€μ—­ν­**: **20-30%** μ μ•½
- **λ μ΄ν„΄μ‹**: **80-100ms** (μμƒ)

**μ„±λ¥ μ ν• μ”μΈ**:
- LeakyReLU 402κ° μ—°μ‚° CPU μ²λ¦¬ (24.0%)
- μ–‘μν™”/μ—­μ–‘μν™” μ¤λ²„ν—¤λ“ 118ν (7.0%)
- NPU β†” CPU λ°μ΄ν„° μ΄λ™ λΉ„μ©

---

## π› οΈ **NPU vs CPU μ¤νΌλ μ΄ν„° λ¶„λ¥**

### **NPU μµμ ν™” μ¤νΌλ μ΄ν„°** β…
1. **ν•µμ‹¬ μ—°μ‚°**:
   - `qnn.conv2d`: 2D μ»¨λ³Όλ£¨μ… (INT8)
   - `nn.bias_add`: λ°”μ΄μ–΄μ¤ μ¶”κ°€
   - `clip`: ReLU ν΄λ¦¬ν•‘

2. **λ©”λ¨λ¦¬ μ—°μ‚°**:
   - `reshape`: ν…μ„ μ¬κµ¬μ„±
   - `strided_slice`: ν…μ„ μ¬λΌμ΄μ‹±
   - `qnn.concatenate`: ν…μ„ μ—°κ²°

3. **μ–‘μν™” μ—°μ‚°**:
   - `qnn.requantize`: μ¬μ–‘μν™” (μ¤μΌ€μΌ μ΅°μ •)

### **CPU ν΄λ°± μ¤νΌλ μ΄ν„°** β
1. **ν™μ„±ν™” ν•¨μ**:
   - `nn.leaky_relu`: LeakyReLU (FP32 ν•„μ”)
   - `nn.softmax`: Softmax (λ³µμ΅ν• μν•™ μ—°μ‚°)

2. **νƒ€μ… λ³€ν™**:
   - `qnn.quantize`: INT8 β†’ FP32 λ³€ν™
   - `qnn.dequantize`: FP32 β†’ INT8 λ³€ν™

3. **λ³µμ΅ν• μ—°μ‚°**:
   - `nn.max_pool2d`: μΌλ¶€ ν’€λ§ μ—°μ‚°
   - `qnn.add/subtract`: μΌλ¶€ μ‚°μ  μ—°μ‚°

---

### **ν–¥ν›„ κ°λ° λ°©ν–¥**

#### **λ‹¨κΈ° λ©ν‘ (1-2κ°μ›”)**

1. ReLU6 μ μ©

2. QAT μ μ©

---

*μ΄ λ¶„μ„μ€ TVM + Ethos-N λ°±μ—”λ“λ¥Ό ν†µν• μ‹λ®¬λ μ΄μ… κ²°κ³Όλ¥Ό λ°”νƒ•μΌλ΅ ν•λ©°, μ‹¤μ  ν•λ“μ›¨μ–΄μ—μ„λ” μ¶”κ°€μ μΈ μµμ ν™”κ°€ κ°€λ¥ν•  μ μμµλ‹λ‹¤.*

**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2025-10-02